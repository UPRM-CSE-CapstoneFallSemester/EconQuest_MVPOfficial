{% extends 'admin/layout.html' %}
{% block admin_content %}

<style>
  .admin-kpi-card{
    border-radius: 1rem;
    box-shadow: 0 10px 24px rgba(15,23,42,.08);
  }
  .admin-kpi-label{
    font-size: .8rem;
  }
  .admin-quick-link{
    display:flex;
    flex-direction:column;
    gap:.15rem;
    border-radius: .9rem;
    padding:.75rem 1rem;
    background: #f8fafc;
  }
  .dark .admin-quick-link{
    background: #020617;
  }
  .admin-quick-link:hover{
    border-color: rgb(16 185 129);
    box-shadow:0 10px 24px rgba(16,185,129,.18);
  }
</style>

<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold">Panel de administraciÃ³n</h1>
    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
      Monitorea la salud de EconQuest, gestiona usuarios y ajusta el sistema de XP.
    </p>
  </div>

</div>

{# ===== KPIs: salud de plataforma ===== #}
<div class="grid md:grid-cols-3 gap-4 mb-6">
  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">Disponibilidad (Ãºltima hora)</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">
      {{ "%.1f%%"|format(stats.availability_pct) }}
    </div>
    <div class="text-xs text-slate-500 mt-2">Respuestas con cÃ³digo &lt; 500</div>
  </div>

  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">p95 /student/dashboard</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">
      {{ stats.p95_ms }} ms
    </div>
    <div class="text-xs text-slate-500 mt-2">Ãšltima hora</div>
  </div>

  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">Usuarios</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">
      {{ stats.total_users }}
      <span class="text-sm text-slate-400">Â· {{ online }} online</span>
    </div>
    <div class="text-xs text-slate-500 mt-2">
      {{ stats.students }} estudiantes Â· {{ stats.teachers }} docentes
    </div>
  </div>
</div>

{# ===== KPIs: contenido / juego ===== #}
<div class="grid md:grid-cols-3 gap-4 mb-8">
  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">MÃ³dulos</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">{{ stats.modules }}</div>
    <div class="text-xs text-slate-500 mt-2">{{ stats.published }} publicados</div>
  </div>
  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">Actividades</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">{{ stats.activities }}</div>
    <div class="text-xs text-slate-500 mt-2">Totales</div>
  </div>
  <div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-5 rounded-2xl admin-kpi-card">
    <div class="admin-kpi-label text-slate-500">Intentos</div>
    <div class="text-2xl font-semibold text-emerald-500 mt-1">{{ stats.attempts }}</div>
    <div class="text-xs text-slate-500 mt-2">HistÃ³rico</div>
  </div>
</div>

{# ===== ATAJOS DE ADMINISTRACIÃ“N ===== #}
<section class="mb-10">
  <h2 class="font-semibold mb-3 text-slate-700 dark:text-slate-100">
    Atajos de administraciÃ³n
  </h2>
  <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm">
    <a
      class="admin-quick-link border border-slate-200 dark:border-slate-800 hover:border-emerald-500"
      href="{{ url_for('admin.users_view') }}"
    >
      <span class="font-semibold">ðŸ‘¥ Users & Roles</span>
      <span class="text-slate-500 dark:text-slate-400">
        Cambia rÃ¡pidamente permisos de docentes y estudiantes.
      </span>
    </a>

    <a
      class="admin-quick-link border border-slate-200 dark:border-slate-800 hover:border-emerald-500"
      href="{{ url_for('admin.data_home') }}"
    >
      <span class="font-semibold">ðŸ“Š Data Browser</span>
      <span class="text-slate-500 dark:text-slate-400">
        Explora tablas (mÃ³dulos, actividades, intentos, gruposâ€¦).
      </span>
    </a>

    {# OJO: si tu endpoint se llama distinto, cambia 'live_sessions' por el que uses. #}
    <a
      class="admin-quick-link border border-slate-200 dark:border-slate-800 hover:border-emerald-500"
      href="{{ url_for('admin.api_active_sessions') }}"
    >
      <span class="font-semibold">ðŸŸ¢ Sesiones en vivo</span>
      <span class="text-slate-500 dark:text-slate-400">
        Ver quiÃ©n estÃ¡ conectado ahora mismo y desde dÃ³nde.
      </span>
    </a>

    {# OJO: igual aquÃ­, ajusta el endpoint si tu ruta de settings tiene otro nombre. #}
    <a
      class="admin-quick-link border border-slate-200 dark:border-slate-800 hover:border-emerald-500"
      href="{{ url_for('admin.settings_view') }}"
    >
      <span class="font-semibold">ðŸŽ® Game / XP Settings</span>
      <span class="text-slate-500 dark:text-slate-400">
        Ajusta curva de XP y lÃ­mite de intentos por actividad.
      </span>
    </a>
  </div>
</section>

{# ===== USUARIOS RECIENTES ===== #}
<div class="bg-white dark:bg-slate-900 dark:text-slate-100 p-6 rounded-2xl shadow mb-10">
  <div class="flex items-center justify-between">
    <h2 class="font-semibold">Usuarios registrados</h2>
    <a class="px-3 py-2 rounded bg-emerald-600 text-white" href="{{ url_for('admin.users_view') }}">
      Gestionar roles
    </a>
  </div>
  <table class="mt-3 w-full text-sm">
    <thead>
      <tr class="text-left">
        <th>Nombre</th><th>Email</th><th>Rol</th><th>Creado</th>
      </tr>
    </thead>
    <tbody>
      {% for u in recent_users %}
      <tr class="border-t border-slate-200 dark:border-slate-700">
        <td>{{ u.name }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.role }}</td>
        <td>{{ u.created_at.strftime('%Y-%m-%d') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


{% endblock %}

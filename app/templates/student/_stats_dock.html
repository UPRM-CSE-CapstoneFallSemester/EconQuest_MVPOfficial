{# ====== STATS DOCK DERECHA, COLAPSABLE COMPLETO ====== #}
<style>
  :root{
    --stats-width: 320px;   /* ancho del panel */
    --stats-handle: 38px;   /* tama√±o del bot√≥n redondo */
    --stats-top: 96px;      /* separaci√≥n desde el navbar */
  }

  /* Panel fijo al lado DERECHO */
  #statsDock{
    position: fixed;
    top: var(--stats-top);
    right: 16px;
    width: var(--stats-width);
    z-index: 40;
    transition: right .25s ease, opacity .25s ease;
  }

  /* Cuando est√° colapsado: se va COMPLETO fuera de la pantalla */
  #statsDock.collapsed{
    right: calc(-1 * var(--stats-width) - 32px);
    opacity: .95;
  }

  #statsDock .stats-card{
    background: #0b1324;
    color: #e6f7f1;
    border: 1px solid rgba(148,163,184,.18);
    border-radius: 18px;
    box-shadow: 0 12px 32px rgba(0,0,0,.4);
    padding: 16px 16px 14px;
    margin-top: 55px;
  }

  #statsDock .stats-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:8px;
  }
  #statsDock .stats-title{
    font-weight:700;
    font-size:14px;
  }
  #statsDock .stats-badge{
    font-size:11px;
    opacity:.8;
    background: rgba(16,185,129,.16);
    border-radius:999px;
    padding:2px 8px;
  }

  #statsDock ul{
    list-style:none;
    padding:0;
    margin:4px 0 0 0;
  }
  #statsDock li{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:7px 9px;
    border-radius:10px;
    font-size:13px;
  }
  #statsDock li:hover{
    background: rgba(16,185,129,.08);
  }
  #statsDock .k{
    display:flex;
    align-items:center;
    gap:8px;
    color:#cdebe3;
    font-weight:500;
  }
  #statsDock .k span.label{ font-size:13px; }
  #statsDock .v{
    font-weight:700;
    color:#9ff3cf;
    font-variant-numeric: tabular-nums;
  }

  #statsDock .hint{
    font-size:11px;
    color:#b6d7cf;
    opacity:.85;
    margin-top:7px;
    background: rgba(16,185,129,.06);
    border:1px solid rgba(16,185,129,.18);
    padding:6px 8px;
    border-radius:10px;
  }

  /* Bot√≥n flotante SIEMPRE en el borde derecho */
  #statsHandle{
    position: fixed;
    top: calc(var(--stats-top) + 8px);
    right: 12px;
    width: var(--stats-handle);
    height: var(--stats-handle);
    border-radius: 9999px;
    background: #10b981;
    color:#06281f;
    font-weight: 900;
    display:grid;
    place-items:center;
    box-shadow: 0 10px 22px rgba(16,185,129,.35);
    border: 1px solid rgba(6,24,20,.45);
    cursor:pointer;
    transition: transform .2s ease, filter .2s ease;
    z-index: 41; /* encima del panel */
  }
  #statsHandle:hover{
    transform: translateY(-1px);
    filter:brightness(1.05);
  }

  /* ‚Äî En m√≥vil: lo volvemos barra inferior que se esconde hacia abajo ‚Äî */
  @media (max-width: 1024px){
    #statsDock{
      left: 12px;
      right: 12px;
      width: auto;
      top: auto;
      bottom: 12px;
      transition: transform .25s ease, opacity .25s ease;
      right: 12px; /* por si acaso */
    }
    #statsDock.collapsed{
      transform: translateY(calc(100% + 20px));
    }
    #statsHandle{
      top: auto;
      bottom: 16px;
      right: 16px;
    }
  }
</style>

<!-- Bot√≥n flotante (siempre visible) -->
<button id="statsHandle"
        aria-controls="statsDock"
        aria-expanded="true"
        title="Mostrar/ocultar stats">
  ¬ª
</button>

<!-- Panel de stats -->
<aside id="statsDock" aria-label="Mis stats">
  <div class="stats-card">
    <div class="stats-head">
      <div class="stats-title">Mis stats</div>
      <div class="stats-badge">
        Nivel {{ profile.level or 1 }}
      </div>
    </div>

    <ul>
      <li>
        <div class="k">‚≠ê <span class="label">Nivel</span></div>
        <div class="v">{{ profile.level or 1 }}</div>
      </li>
      <li>
        <div class="k">‚ö° <span class="label">XP</span></div>
        <div class="v">{{ profile.xp or 0 }}</div>
      </li>
      <li>
        <div class="k">ü™™ <span class="label">Cr√©dito</span></div>
        <div class="v">{{ profile.credit_score or 650 }}</div>
      </li>
      <li>
        <div class="k">üíµ <span class="label">Efectivo</span></div>
        <div class="v">$ {{ (profile.cash_balance or 0)|round(0) }}</div>
      </li>
    </ul>

    <div class="hint">
      Gana XP y üíµ con misiones, cuida tu energ√≠a y mejora tu score. üéØ
    </div>
  </div>
</aside>

<script>
(function(){
  const dock   = document.getElementById('statsDock');
  const handle = document.getElementById('statsHandle');

  const setCollapsed = (v) => {
    dock.classList.toggle('collapsed', v);
    handle.setAttribute('aria-expanded', String(!v));

    const isMobile = window.matchMedia('(max-width:1024px)').matches;
    // Derecha:
    //  - colapsado => ¬ª (entra desde la derecha / abajo)
    //  - abierto   => ¬´ (se esconde hacia la derecha / abajo)
    handle.textContent = v
      ? (isMobile ? '‚ñ≤' : '¬´')
      : (isMobile ? '‚ñº' : '¬ª');

    try{ localStorage.setItem('stats-collapsed', v ? '1' : '0'); }catch(_){}
  };

  let initial = false;
  try{ initial = localStorage.getItem('stats-collapsed') === '1'; }catch(_){}
  setCollapsed(initial);

  handle.addEventListener('click', () => {
    setCollapsed(!dock.classList.contains('collapsed'));
  });

  // Opcional: Ctrl/Cmd + S para togglear
  window.addEventListener('keydown', (e)=>{
    if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){
      e.preventDefault();
      setCollapsed(!dock.classList.contains('collapsed'));
    }
  });

  // Reajusta iconito cuando cambie ancho (desktop <-> m√≥vil)
  window.addEventListener('resize', () => {
    const v = dock.classList.contains('collapsed');
    setCollapsed(v);
  });
})();
</script>

{% extends 'teacher/layout.html' %}
{% block teacher_content %}

<h1 class="text-2xl font-bold mb-4 text-emerald-400">Students</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="space-y-2 mb-4">
      {% for cat, msg in messages %}
        <div class="p-2 rounded {{ 'bg-emerald-900/30 text-emerald-200 border border-emerald-700/40' if cat=='success' else 'bg-red-900/30 text-red-100 border border-red-700/40' }}">
          {{ msg }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="overflow-x-auto">
  <table class="w-full text-sm">
    <thead>
      <tr class="text-emerald-300">
        <th class="text-left p-2">ID</th>
        <th class="text-left p-2">Name</th>
        <th class="text-left p-2">Email</th>
        <th class="text-left p-2">Add to group</th>
      </tr>
    </thead>
    <tbody>
      {% for s in students %}
      <tr class="border-t border-emerald-800/50">
        <td class="p-2 font-mono">{{ s.id }}</td>
        <td class="p-2">{{ s.name }}</td>
        <td class="p-2">{{ s.email }}</td>
        <td class="p-2">
          <form method="post" action="{{ url_for('teacher.students_add_to_group') }}" class="flex items-center gap-2">
            <!-- CSRF IS REQUIRED -->
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="student_id" value="{{ s.id }}">
            <select name="group_id" class="px-2 py-1 rounded bg-emerald-950/40 border border-emerald-800/60" required>
              <option value="">Select group</option>
              {% for g in groups %}
                <option value="{{ g.id }}">{{ g.name }} ({{ g.grade or '-' }})</option>
              {% endfor %}
            </select>
            <button class="px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-500 text-white">Add</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td class="p-3 text-emerald-300" colspan="4">No students found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
